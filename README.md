# make2\_new — توليد تسميات تصنيفات ويكيبيديا العربية

مشروع **make2\_new** يوفر مكتبة وأدوات مساعدة لتحويل أسماء التصنيفات (عادة باللغة الإنجليزية كما تظهر في ويكيبيديا) إلى تسميات عربية قياسية مهيأة للنشر بصيغة `تصنيف:`. يعتمد النظام على سلسلة من البوتات وقواعد البيانات المترجمة التي تتعرف على الأنماط الزمنية، الجغرافية، الرياضية، والوظيفية، ثم تنتج تسمية عربية متسقة يمكن استخدامها مباشرة في ويكيبيديا العربية أو في مهام فحص البيانات.

## الهدف والمنهجية
- **التطبيع**: تنظيف أسماء التصنيفات وإزالة المحارف غير المرغوب فيها وتحويل الشرطات السفلية إلى فراغات.
- **حل التسمية**: تمرير التصنيف عبر طبقات من محركات الترجمة والقواعد (مثل معالجة السنين والأنواع والترجمات الجاهزة) للحصول على تسمية أولية.
- **إضافة البادئة**: تزيين التسمية المقبولة ببادئة `تصنيف:` عند الحاجة للحصول على الصيغة النهائية.
- **العمل بالدفعات**: معالجة قوائم كاملة من التصنيفات بسرعة مع الاحتفاظ ببيانات وسيطة لمراجعة الحالات التي لم تحصل على تسمية.

## المتطلبات والتثبيت
1. تثبيت بايثون 3.10 أو أحدث.
2. إنشاء بيئة افتراضية وتثبيت الحزم:
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.in
   ```
3. (اختياري) فعّل متغيرات البيئة للتحكم في الميزات الاختيارية مثل `ENABLE_WIKIDATA`، أو `ENABLE_KOOORA`، أو `YEMENTEST`، وغيرها الموضحة في `src/config.py`.

## الاستخدام السريع
### الحصول على تسمية واحدة
```python
from make2_new import config_logger, new_func_lab_final_label

config_logger()
label = new_func_lab_final_label("Category:2015 American television")
print(label)  # يطبع تسمية عربية بصيغة تصنيف جاهزة
```

### معالجة دفعة من التصنيفات
```python
from make2_new import EventProcessor

categories = [
    "Category:2015 American television",
    "Category:1999 establishments in Europe",
    "Category:Belgian cyclists",
]
processor = EventProcessor()
result = processor.process(categories)

print(result.labels)    # قاموس من التصنيف بعد التطبيع إلى التسمية العربية النهائية
print(result.no_labels) # قائمة التصنيفات التي لم تُجد لها تسمية
```

### تشغيل المثال المضمّن
لتجربة مسار بسيط، شغّل:
```bash
python run.py
```
وسيتم طباعة تسمية عربية للتصنيف التجريبي في الملف.

## توسيع البيانات والقواعد
- **إضافة ترجمات جديدة**: توضع ملفات الترجمات في مجلد `src/translations/` (مثل `sports/` للرياضة أو `geo/` للجغرافيا). اتبع نمط القوائم/القواميس المستخدمة في الملفات الحالية وأضف حالات الاختبار المناسبة.
- **تعديل منطق الحل**: المنطق الرئيسي لحل التسميات موجود في `src/main_processers/main_resolve.py`. أي قاعدة جديدة يجب أن تُدرج هناك مع مراعاة ترتيب الأولويات والتخزين المؤقت.
- **تنسيق المخرجات**: معالجة البادئة والتطبيع تتم في `src/event_processing.py` عبر الصنف `EventProcessor`، لذا تأكد من بقاء العقدة النهائية متوافقة مع هذا التدفق.

## بنية المشروع
- `src/event_processing.py`: نقطة الدخول الأساسية لمعالجة التصنيفات، تشمل التطبيع وإضافة البادئة وإرجاع بنية النتائج.
- `src/main_processers/`: طبقات المنطق التي تحل التسميات (سنوات، أحداث، وظائف، وغيرها) وتعيد التسمية الخام قبل إضافة البادئة.
- `src/make2_bots/`: مجموعة بوتات وأدوات مساعدة لتعديل التصنيفات، ترجمة الأنماط، وتطبيق قواعد خاصة بالمجالات.
- `src/translations/`: بيانات الترجمة الجاهزة والجداول المساعدة (رياضة، جغرافيا، ترفيه، لغات، جنسيات، ...).
- `src/utils/` و`src/helps/`: أدوات مساعدة للتطبيع، التسجيل، القياس، وطباعة الأطوال.
- `run.py`: مثال قصير يوضح كيف يمكن استدعاء الوظائف العامة من الحزمة.
- `tests/`: اختبارات وحدات موسعة تعتمد على قوائم بيانات تغطي معظم السيناريوهات الشائعة.
- `requirements.in`, `pyproject.toml`, `pytest.ini`: ملفات الضبط للأدوات والاعتمادات.

## ضبط السجلات والمخرجات
استخدم `config_logger` للتحكم في مستوى السجلات. يمكن تعطيل الطباعة بالكامل أو تمكينها عبر متغيرات البيئة `ALL_PRINT_OFF` أو `NOPRINT`. جميع رسائل السجل تستخدم سلاسل مهيأة للتسهيل.

## تشغيل الاختبارات
بعد أي تعديل شغّل:
```bash
pytest
```
تُغطّي مجموعة الاختبارات حالات متعددة من الترجمة ومعالجة التصنيفات للتأكد من استقرار المنهجية.

## ملاحظات مساهمة
- حافظ على الاتساق في الترجمات الجديدة وأضف تغطية اختبارية للحالات التي تُضيفها.
- عند تعديل تدفق الحل، راقب تأثيره على الأداء لأن المنظومة تعتمد على التخزين المؤقت لتسريع الاستعلامات المتكررة.
- التزم بدليل التنسيق (Black/Isort/Ruff) المضبوط في `pyproject.toml` قبل إرسال التعديلات.
