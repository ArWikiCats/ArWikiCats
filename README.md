# make2 — نظام تعريب وتصنيف تلقائي لتصنيفات ويكيبيديا العربية

[![License](https://img.shields.io/badge/license-MIT-green)]()
[![Python](https://img.shields.io/badge/Python-3.10+-blue)]()
[![Status](https://img.shields.io/badge/status-Beta-orange)]()
[![Tests](https://img.shields.io/badge/tests-Pytest-success)]()

---

مشروع **make2** هو محرك شامل لمعالجة أسماء التصنيفات (Categories) في ويكيبيديا، غالبًا باللغة الإنجليزية، وتحويلها إلى **تسميات عربية قياسية** بصيغة جاهزة للنشر مثل:
**تصنيف:تأسيسات القرن 20 في أوقيانوسيا**

يعتمد النظام على منظومة واسعة من قواعد الترجمة، والقواميس، والأنماط الزمنية، والمحركات (Bots) المتخصصة التي تغطي مجالات مثل:

* السنوات والفترات الزمنية
* الوظائف والمهن
* البلدان والجنسيات
* الفرق الرياضية والبطولات
* الأفلام والإعلام
* الجغرافيا
* الأحداث العامة والمتنوعة

ويهدف المشروع إلى توفير حل موحد، سريع، قابل للتوسعة، ويعمل بدقة عالية على ملايين التصنيفات.

---

# 1. المزايا الرئيسية

* **سرعة عالية جداً** بعد التحسينات الأخيرة (500 ألف عنوان في أقل من دقيقتين).
* **قواعد جاهزة** تغطي آلاف الحالات (سنوات – بلدان – وظائف – رياضة – أفلام – إعلام).
* **تخزين مؤقت (Cache)** شامل لتسريع الأداء.
* **نظام وحدات (Bots)** قابل للتحديث والإضافة بسهولة.
* **نتائج موحّدة ومتسقة** مع أسلوب ويكيبيديا العربية.
* **دعم معالجة الدفعات** لقوائم من آلاف التصنيفات.
* **كشف الحالات التي لا تملك تسمية** ورفعها للمراجعة.

---

# 2. كيف يعمل النظام؟

المعالجة الكاملة تمر عبر ست مراحل رئيسية:

## 2.1 التطبيع (Normalization)

يتم تنظيف الاسم وإزالة العناصر الزائدة:

* إزالة الشرطات السفلية.
* إزالة الرموز غير العملية.
* توحيد المسافات.
* إزالة بادئة "Category:".

الكود المسؤول:
`EventProcessor._normalize_category`

---

## 2.2 اكتشاف الأنماط الزمنية

يحاول النظام معرفة ما إذا كان التصنيف يحتوي:

* سنة
* عقد
* قرن
* مدى زمني

مثال:
`1550s establishments in Namibia` → **تأسيسات عقد 1550 في ناميبيا**

الوحدات المستخدمة:

* `labs_years.lab_from_year`
* `ye_ts_bot.translate_general_category`

---

## 2.3 مطابقة القواعد والترجمات الجاهزة

يتم المرور على قواعد خاصة للمجالات:

* الوظائف: `jobs_bots`
* الرياضة: `sport_lab_suffixes`, `format_bots`
* الأفلام والإعلام: `media_bots`
* البيانات الجغرافية: ملفات داخل `translations/geo`

كما يتم استعمال الكاش الجاهز:

* `cash_2022`
* `event2bot`
* `event_lab_bot`

---

## 2.4 المنطق العام لحل التسمية

يتم تجميع النتيجة عبر وحدة مركزية:
`main_processers/main_resolve.py`

هذه الوحدة:

* تجرب قواعد كثيرة بالتسلسل.
* تتوقف عند أول نتيجة صحيحة.
* تضمن ترتيب الأولويات.

---

## 2.5 تنسيق النتيجة النهائية

يشمل:

* إصلاح بعض العبارات.
* ضبط الصياغة العربية.
* معالجة الحالات الغريبة.

باستخدام:
`fixtitle.fixlab`

---

## 2.6 إضافة بادئة «تصنيف:»

إذا كانت النتيجة صالحة، يقوم النظام بإضافة البادئة تلقائيًا:
`EventProcessor._prefix_label`

---

# 3. المتطلبات والتثبيت

## 3.1 المتطلبات

* Python 3.10 أو أحدث
* مكتبات مساعدة موجودة في `requirements.in`

## 3.2 خطوات التثبيت

```bash
git clone https://github.com/MrIbrahem/make2_new.git make2
cd make2

python -m venv .venv
source .venv/bin/activate   # أو في ويندوز: .venv\Scripts\activate

pip install -r requirements.in
```

---

# 4. الاستخدام السريع

## 4.1 معالجة تصنيف واحد

```python
from make2 import new_func_lab_final_label

label = new_func_lab_final_label("Category:2015 American television")
print(label)
# تصنيف:تلفاز أمريكي 2015
```

---

## 4.2 معالجة قائمة كاملة

```python
from make2 import EventProcessor

categories = [
    "Category:2015 American television",
    "Category:1999 establishments in Europe",
    "Category:Belgian cyclists",
]

processor = EventProcessor()
result = processor.process(categories)

print(result.labels)     # قاموس {category_normalized: arabic_label}
print(result.no_labels)  # قائمة التصنيفات التي لم يتم إيجاد تسمية لها
```

---

## 4.3 تشغيل المثال الجاهز

```bash
python run.py
```

---

# 5. التحكم في السلوك – متغيرات البيئة

يمكن تخصيص سلوك النظام باستخدام المتغيرات التالية:

* `YEMENTEST=1`
* `STUBS`
* `MAKEERR`
* `LOAD_P17NAT`
* `NOPRINT=1`

توثيق هذه الخيارات موجود في `src/config.py`.

---

# 6. توسيع النظام – إضافة قواعد جديدة

## 6.1 إضافة ترجمات جديدة

ضع الملفات داخل:
`src/translations/`
أمثلة:

* `translations/sports/`
* `translations/geo/`
* `translations/jobs/`

اتبع الأسلوب المعتمد:

```python
jobs_mens_data = {
    "footballers": "لاعبو كرة قدم",
    "painters": "رسامون",
}
```

---

## 6.2 إضافة قواعد جديدة في محرك الترجمة

يتم تعديل أو إضافة المنطق في:
`src/main_processers/main_resolve.py`

مثال إضافة منطق جديد:

```python
if not resolved_label:
    resolved_label = new_bot.translate(cate)
```

احرص على ترتيب الأولويات بعناية.

---

## 6.3 إضافة بوت جديد لمجال جديد

ضع البوت في:
`src/make2_bots/yourdomain_bot.py`

ويجب:

1. كتابة دوال معالجة.
2. ربطه في سلسلة الحل داخل `main_resolve`.
3. إضافة حالات اختبار.

---

# 7. بنية المشروع (خريطة الملفات)

```
src/
│
├── main.py                        # نقطة الدخول العامة
├── event_processing.py            # التطبيع + إضافة البادئة + إخراج النتائج
│
├── main_processers/
│   ├── main_resolve.py            # المحرك المركزي لحل التسمية
│   ├── event2bot.py
│   └── event_lab_bot.py
│
├── make2_bots/                    # بوتات متخصصة
│   ├── date_bots/
│   ├── jobs_bots/
│   ├── media_bots/
│   └── format_bots/
│
├── translations/                  # القواميس والملفات المترجمة
│   ├── geo/
│   ├── sports/
│   ├── jobs/
│   └── medical/
│
├── translations_formats/          # قوالب صياغة اللغة العربية
│
├── helps/                         # أدوات مساعدة (logging, قياس, utils)
│
├── utils/                         # أدوات عامة
│
└── tests/                         # منظومة الاختبارات
```

---

# 8. الاختبارات

بعد أي تحديث، يجب تنفيذ:

```bash
pytest
```

يغطي النظام اختبار:

* الوظائف
* السنوات
* البلدان
* الأنماط المعقدة
* الحالات النادرة
* أداء الترجمة
* مطابقة القواميس

---

# 9. الأداء وقياس السرعة

بعد التحسينات الأخيرة:

* خفض استخدام الذاكرة من **٢ جيجا** إلى **183 ميجا**.
* تقليل زمن التعريب في الاختبارات من **5 دقائق** إلى **ثانيتين – 4 ثواني** تقريبًا.
* تعريب **500 ألف تصنيف في أقل من دقيقتين**.

يمكن تشغيل Scalene:

```bash
python -m scalene run.py
```

---

# 10. ملاحظات للمساهمين

* حافظ على أسلوب كتابة القاموس والاختبارات.
* أي إضافة جديدة يجب أن تشمل:

  * قاعدة جديدة
  * اختبار لهذه القاعدة
  * تحديث للترجمات إن لزم
* تأكد من التنسيق باستخدام Black و Isort و Ruff.

---

# 11. الخلاصة

مشروع **make2** هو نظام شامل ومرن وقابل للتوسعة لمعالجة تصنيفات ويكيبيديا وتعريبها بسرعة ودقة عالية، ويجمع بين:

* محركات ترجمة متخصصة
* بيانات جاهزة
* كاش سريع
* اختبارات واسعة
* أداء قوي

وهو مناسب لمهام البوتات، خطوط الإنتاج التحريرية، والعمليات الضخمة مثل تعريب آلاف التصنيفات في دفعة واحدة.
