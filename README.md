# make2_new — نظام تعريب وتصنيف تلقائي لتصنيفات ويكيبيديا

## ما هو المشروع؟
مشروع **make2_new** يوفّر محركًا سريعًا لتوليد أسماء التصنيفات العربية بناءً على أسماء تصنيفات (غالبًا باللغة الإنجليزية) في ويكيبيديا. يعتمد على مجموعة كبيرة من قواعد التحويل، والبيانات المترجمة، ومحركات متخصصة (bots) لتغطية مجالات مثل السنوات، الأعمال الفنية، الوظائف، الأحداث الرياضية، والجغرافيا. الواجهة العامة تتيح معالجة تصنيف واحد أو حزمة كاملة وإرجاع التسمية العربية المناسبة أو الإبلاغ عن العناصر التي لا تمتلك تسمية بعد.

## الهدف الرئيسي
* تسريع بناء أو تحديث التصنيفات العربية بشكل موحّد ومتكرر.
* تقليل الأخطاء البشرية في الترجمة عبر قواعد ثابتة وقابلة للتوسعة.
* توفير نقطة دخول برمجية يمكن دمجها مع أدوات البوتات أو خطوط معالجة البيانات.

## كيف يعمل النظام؟
1. **تطبيع الاسم المدخل**: تتم إزالة المحارف غير المرغوبة واستبدال الشرطات السفلية بمسافات قبل بدء المعالجة (`EventProcessor._normalize_category`).
2. **حل التسمية**: تستدعي دالة `resolve_label` عدة خطوات مترابطة:
   * تنسيق الاسم وإصلاحه (`change_cat`).
   * التحقق من القابلية للمعالجة (تجاهل الأسماء غير اللاتينية أو غير المؤهلة) عبر `filter_en`.
   * محاولة اكتشاف السنوات أو الفترات الزمنية (`labs_years.lab_from_year`, `ye_ts_bot.translate_general_category`).
   * البحث في جداول بيانات مترجمة وكاشات جاهزة (`cash_2022`, قواعد `event2bot` و`event_lab_bot`).
   * تنسيق التسمية النهائية وضبطها حسب العنوان الإنجليزي (`fixtitle.fixlab`).
3. **إضافة بادئة التصنيف**: تُضاف بادئة «تصنيف» تلقائيًا إذا كانت التسمية صالحة (`EventProcessor._prefix_label`).
4. **تجميع النتائج**: تُعاد النتيجة على شكل كائن `EventProcessingResult` يحوي العناصر المعالجة، التسمية النهائية، وقائمة التصنيفات التي لم تُترجم بعد. الواجهة السريعة `event(...)` توفّر تغليفًا جاهزًا للطباعات الاختيارية وإرجاع النتائج.

## المتطلبات والتثبيت
1. تأكد من وجود Python 3.10 أو أحدث.
2. أنشئ بيئة افتراضية (اختياري لكن موصى به):
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   ```
3. ثبّت الاعتمادات:
   ```bash
   pip install -r requirements.in
   ```

## طريقة الاستخدام السريعة
### استدعاء برمجي
استخدم الواجهات المصدّرة من الحزمة:
```python
from src import new_func_lab_final_label, event_result

# إرجاع تسمية عربية كاملة مع البادئة «تصنيف»
print(new_func_lab_final_label("Category:2015 American television"))

# معالجة قائمة من التصنيفات والحصول على العناصر غير المترجمة
result = event_result(["Category:Totally Nonexistent Category"])
print(result.labels)      # التصنيفات التي تمت ترجمتها
print(result.no_labels)   # التصنيفات التي تحتاج إضافة بيانات
```
### تشغيل مثال جاهز
يوجد ملف `run.py` يطبع ناتج استعلام واحد يمكن استخدامه كاختبار سريع للبيئة:
```bash
python run.py
```

## ضبط السلوك عبر المتغيرات
يمكن تشغيل خصائص إضافية عبر متغيرات بيئية أو معاملات سطر الأوامر:
* `ENABLE_WIKIDATA=1` لتفعيل ربط ويكي بيانات.
* `ENABLE_KOOORA=1` لتفعيل منطق رياضي خاص.
* `YEMENTEST=1` لتفعيل مسار تجريب البدء بالقيم الزمنية.
* `-STUBS`, `MAKEERR`, `LOAD_P17NAT` لخيارات إضافية للتنقيح أو التحميل المسبق للبيانات.
* `ALL_PRINT_OFF=1` أو `NOPRINT=1` لتعطيل الطباعة.

## كيفية توسيع البيانات والقواعد
* **البيانات المترجمة**: أضف أو حدّث الجداول في `src/translations/` (مثل `by_type.py`, مجلدات `geo`, `jobs`, `medical`) لإدراج مصطلحات جديدة أو تحسين ترجمات موجودة.
* **قواعد التوليد**: لتعديل المنطق الأساسي للتسمية أو إضافة نوع جديد، راجع وحدات البوتات داخل `src/make2_bots/` مثل:
  * `ma_bots/` لقواعد الأنواع والبلدان.
  * `date_bots/` للمحتوى الزمني.
  * `media_bots/` للأفلام والأعمال الفنية.
* **التنسيقات النهائية**: يضم مجلد `src/translations_formats/` قواعد تنسيق إضافية يمكن تعديلها لضبط بناء العبارات العربية.
* بعد أي تحديث، شغّل الاختبارات للتأكد من سلامة المنظومة.

## خريطة الملفات الأساسية
* `src/main.py`: نقطة دخول عالية المستوى توفر الدالة `event` لتشغيل خط المعالجة الكامل.
* `src/event_processing.py`: المحرك المركزي الذي يطبّق التطبيع، استدعاء `resolve_label`، وبناء النتائج ككائنات بيانات.
* `src/main_processers/main_resolve.py`: محور حل التسمية الذي ينسّق بين قواعد الترجمة، الكاش، والتنسيق النهائي.
* `src/make2_bots/`: مجموعة وحدات متخصصة (bots) تغطي مجالات مثل الزمن، الرياضة، البلدان، الإعلام، والوظائف.
* `src/translations/`: بيانات الترجمة المهيكلة بحسب النوع أو المجال، يمكن توسيعها بإضافة ملفات أو قواميس جديدة.
* `src/translations_formats/`: قوالب تنسيق النصوص والعبارات المساعدة لبناء التسمية.
* `tests/`: تغطية اختبارية متنوعة تشمل مسارات المعالجة الرئيسية وحالات عدم الترجمة لضمان ثبات السلوك.

## تشغيل الاختبارات
يُنصح بتشغيل الاختبارات بعد أي تعديل لضمان استقرار النتائج:
```bash
pytest
```

## ملاحظات إضافية
* يتم تفضيل التسجيل عبر الموجّه `logger` بدل الطباعة المباشرة، ويمكن ضبط مستويات الطباعة عبر إعدادات `src/config.py`.
* يدعم المشروع العمل على قوائم كبيرة من التصنيفات مع الاعتماد على التخزين المؤقت لتقليل تكلفة الحساب المتكرر.
