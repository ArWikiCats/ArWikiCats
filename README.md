# make2 — نظام تعريب وتصنيف تلقائي لتصنيفات ويكيبيديا العربية

[![License](https://img.shields.io/badge/license-MIT-green)]()
[![Python](https://img.shields.io/badge/Python-3.10+-blue)]()
[![Status](https://img.shields.io/badge/status-Beta-orange)]()
[![Tests](https://img.shields.io/badge/tests-13900+-success)]()

---

# جدول المحتويات (TOC)

- [لماذا make2؟](#لماذا-make2)
- [1. المزايا الرئيسية](#1-المزايا-الرئيسية)
- [2. داخل محرك make2 (Pipeline Overview)](#2-داخل-محرك-make2-pipeline-overview)
  - [2.1 التطبيع (Normalization)](#21-التطبيع-normalization)
  - [2.2 اكتشاف الأنماط الزمنية](#22-اكتشاف-الأنماط-الزمنية)
  - [2.3 مطابقة القواعد والقواميس](#23-مطابقة-القواعد-والقواميس)
  - [2.4 المحرك المركزي لحل التسمية](#24-المحرك-المركزي-لحل-التسمية)
  - [2.5 تنسيق النتيجة النهائية](#25-تنسيق-النتيجة-النهائية)
  - [2.6 إضافة بادئة تصنيف](#26-إضافة-بادئة-تصنيف)
- [3. المتطلبات والتثبيت](#3-المتطلبات-والتثبيت)
- [4. الاستخدام السريع](#4-الاستخدام-السريع)
- [5. إعدادات النظام (Environment Variables)](#5-إعدادات-النظام-environment-variables)
- [6. توسيع النظام](#6-توسيع-النظام)
- [7. بنية المشروع](#7-بنية-المشروع)
- [8. الاختبارات](#8-الاختبارات)
- [9. الأداء](#9-الأداء)
- [10. ملاحظات للمساهمين](#10-ملاحظات-للمساهمين)
- [11. القيود الحالية](#11-القيود-الحالية)
- [12. خارطة الطريق (Roadmap)](#12-خارطة-الطريق-roadmap)
- [13. الخلاصة](#13-الخلاصة)

---

## لماذا make2؟

تعريب تصنيفات ويكيبيديا العربية يمثل تحديًا بسبب العدد الهائل من التصنيفات الإنجليزية والأنماط المتداخلة.
يهدف مشروع **make2** إلى معالجة هذه المشكلة عبر بناء نظام قادر على:

* توحيد أسلوب الترجمة.
* معالجة ملايين التصنيفات بدقة عالية.
* تنفيذ أنماط زمنية وجغرافية ووظيفية ورياضية معقدة.
* دعم عمل البوتات ومهام الإنتاج التحريري.

---

# 1. المزايا الرئيسية

* **سرعة عالية للغاية** بعد التحسينات الأخيرة (183MB بدلًا من 2GB).
* **قواعد ترجمة واسعة** تغطي آلاف الأنماط (سنوات – بلدان – وظائف – رياضة – إعلام).
* **Cache داخلي** لتسريع الأداء في كل خطوة.
* **نظام وحدات (Bots)** قابل للتوسعة بسهولة.
* **نتائج دقيقة وموحّدة** متوافقة مع أسلوب ويكيبيديا العربية.
* **قدرة على معالجة دفعات ضخمة** تشمل آلاف أو مئات آلاف التصنيفات.

---

# 2. داخل محرك make2 (Pipeline Overview)

المعالجة الكاملة تمر عبر المراحل التالية:

```

Raw Category
│
▼
Normalization
│
▼
Detect Date/Pattern
│
▼
Match Translation Rules
│
▼
Main Resolver
│
▼
Arabic Formatting
│
▼
Final Label (with تصنيف:)

```

---

## 2.1 التطبيع (Normalization)

تنظيف التصنيف قبل التحليل:

* إزالة الشرطات السفلية.
* توحيد المسافات.
* إزالة الرموز غير الضرورية.
* حذف بادئة Category:.

---

## 2.2 اكتشاف الأنماط الزمنية

التعامل مع الحالات الزمنية مثل:

* سنة: 2015
* عقد: 1550s
* قرن: 20th century
* مدى زمني

مثال:

```
Category:1550s establishments in Namibia → تصنيف:تأسيسات عقد 1550 في ناميبيا

````

---

## 2.3 مطابقة القواعد والقواميس

يشمل ذلك:

* الوظائف: jobs_bots
* الرياضة: sport_lab_suffixes, format_bots
* الأفلام والإعلام: media_bots
* الجغرافيا: translations/geo
* قواعد رقمية وزمنية: date_bots

---

## 2.4 المحرك المركزي لحل التسمية

المسؤول عن orchestrating:

`main_processers/main_resolve.py`

وظيفته:

* تجربة القواعد حسب الأولوية.
* التوقف عند أول تطابق صحيح.
* ضمان الاتساق بين التصنيفات.

---

## 2.5 تنسيق النتيجة النهائية

يشمل:

* تحسين الصياغة العربية.
* تنسيق العبارات.
* تمرير النتيجة عبر `fixlab`.

---

## 2.6 إضافة بادئة "تصنيف:"

عبر:

`EventProcessor._prefix_label`

---

# 3. المتطلبات والتثبيت

## 3.1 المتطلبات

* Python 3.10 أو أحدث
* مكتبات مثبتة من `requirements.in`

## 3.2 التثبيت

```bash
git clone https://github.com/MrIbrahem/make2_new.git make2
cd make2
pip install -r requirements.in
````

---

# 4. الاستخدام السريع

## 4.1 معالجة تصنيف واحد

```python
from make2 import new_func_lab_final_label

label = new_func_lab_final_label("Category:2015 in Yemen")
print(label)
# تصنيف:2015 في اليمن
```

## 4.2 معالجة قائمة كاملة

```python
from make2 import EventProcessor

categories = [
    "Category:2015 American television",
    "Category:1999 establishments in Europe",
    "Category:Belgian cyclists",
]

processor = EventProcessor()
result = processor.process(categories)

print(result.labels)
print(result.no_labels)
```

## 4.3 تشغيل المثال الجاهز

```bash
python run.py
```

---

# 5. إعدادات النظام (Environment Variables)

يمكن تخصيص سلوك النظام باستخدام:

* `YEMENTEST`
* `STUBS`
* `MAKEERR`
* `LOAD_P17NAT`
* `NOPRINT`

تفاصيل كل متغير موجودة في:

`src/config.py`

---

# 6. توسيع النظام

## 6.1 إضافة ترجمات جديدة

ضع القواميس داخل:

`src/translations/`

مثال:

```python
jobs_mens_data = {
    "footballers": "لاعبو كرة قدم",
    "painters": "رسامون",
}
```

## 6.2 إضافة قواعد جديدة

```python
if not resolved_label:
    resolved_label = new_bot.translate(cate)
```

## 6.3 إضافة بوت جديد

```text
src/make2_bots/yourdomain_bot.py
```

مع:

1. دوال المعالجة
2. ربط البوت في resolver
3. إضافة اختبارات

---

# 7. بنية المشروع

```
src/
│
├── main.py
├── event_processing.py
│
├── main_processers/
│   ├── main_resolve.py
│   ├── event2bot.py
│   └── event_lab_bot.py
│
├── make2_bots/
│   ├── date_bots/
│   ├── jobs_bots/
│   ├── media_bots/
│   └── format_bots/
│
├── translations/
│   ├── geo/
│   ├── sports/
│   ├── jobs/
│   └── medical/
│
├── translations_formats/
├── helps/
├── utils/
└── tests/
```

---

# 8. الاختبارات

بعد أي تحديث:

```bash
pytest
```

يغطي المشروع أكثر من **13,900 اختبار** تشمل:

* الوظائف الأساسية
* الأنماط الزمنية
* البلدان والجنسيات
* الأنماط المعقدة
* الحالات النادرة
* أداء النظام
* مطابقة القواميس

## 8.1 تشغيل جزء معين

```bash
pytest -k "jobs"
pytest tests/test_languages/
```

## 8.2 الاختبارات البطيئة

```bash
pytest -m slow
```

---

# 9. الأداء

* استهلاك الذاكرة: حُسن الاستهلاك مقارنة بالكود السابق **2GB → 183MB**
* الاختبارات:  **23 ثانية** (باستخدام `pytest`)
* القدرة على معالجة أكثر من **+5,000 تصنيف** في 10 ثوان. [examples/5k.py](examples/5k.py)

تشغيل Scalene:

```bash
python -m scalene run.py
```

---

# 10. ملاحظات للمساهمين

* أي إضافة يجب أن تشمل قاعدة + قاموس + اختبار.
* الالتزام بـ Black وIsort.
* منع إضافة قواعد بلا اختبارات.

---

# 11. القيود الحالية

* بعض التصنيفات النادرة قد تحتاج معالجة يدوية.
* نتائج بعض الأنماط تتوقف على توفر بيانات في القواميس.
* أنماط معقدة جدًا قد تمر إلى `no_labels`.

---

# 12. خارطة الطريق (Roadmap)

* تحسين وحدة الرياضة (Sport Formatter v3).
* إضافة Redis كخيار Cache إضافي.
* توسيع تغطية التصنيفات الإعلامية والموسيقية.
* دعم لغات جديدة (EN→AR، FR→AR).

---

# 13. الخلاصة

**make2** هو نظام مرن، عالي الأداء، قابل للتوسعة، ويدعم ملايين التصنيفات بسهولة.
يعتمد على:

* قواعد ترجمة متخصصة
* Cache متقدم
* اختبارات صارمة
* تصميم قابل للتطوير

ويعد مناسبًا للبوتات، الأعمال التحريرية، والمشاريع الضخمة في ويكيبيديا العربية.
