<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [ArWikiCats/new_resolvers/__init__.py](../ArWikiCats/new_resolvers/__init__.py)
- [ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py](../ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py)
- [ArWikiCats/new_resolvers/countries_names_resolvers/countries_names_data.py](../ArWikiCats/new_resolvers/countries_names_resolvers/countries_names_data.py)
- [ArWikiCats/new_resolvers/countries_names_with_sports/__init__.py](../ArWikiCats/new_resolvers/countries_names_with_sports/__init__.py)
- [ArWikiCats/new_resolvers/countries_names_with_sports/p17_bot_sport.py](../ArWikiCats/new_resolvers/countries_names_with_sports/p17_bot_sport.py)
- [ArWikiCats/new_resolvers/countries_names_with_sports/p17_sport_to_move_under.py](../ArWikiCats/new_resolvers/countries_names_with_sports/p17_sport_to_move_under.py)
- [ArWikiCats/new_resolvers/films_resolvers/__init__.py](../ArWikiCats/new_resolvers/films_resolvers/__init__.py)
- [ArWikiCats/new_resolvers/films_resolvers/resolve_films_labels.py](../ArWikiCats/new_resolvers/films_resolvers/resolve_films_labels.py)
- [ArWikiCats/new_resolvers/jobs_resolvers/__init__.py](../ArWikiCats/new_resolvers/jobs_resolvers/__init__.py)
- [ArWikiCats/new_resolvers/jobs_resolvers/relegin_jobs_new.py](../ArWikiCats/new_resolvers/jobs_resolvers/relegin_jobs_new.py)
- [ArWikiCats/new_resolvers/nationalities_resolvers/__init__.py](../ArWikiCats/new_resolvers/nationalities_resolvers/__init__.py)
- [ArWikiCats/new_resolvers/sports_resolvers/__init__.py](../ArWikiCats/new_resolvers/sports_resolvers/__init__.py)
- [ArWikiCats/new_resolvers/sports_resolvers/countries_names_and_sports.py](../ArWikiCats/new_resolvers/sports_resolvers/countries_names_and_sports.py)
- [ArWikiCats/new_resolvers/sports_resolvers/nationalities_and_sports.py](../ArWikiCats/new_resolvers/sports_resolvers/nationalities_and_sports.py)
- [ArWikiCats/new_resolvers/sports_resolvers/pre_defined.py](../ArWikiCats/new_resolvers/sports_resolvers/pre_defined.py)
- [ArWikiCats/new_resolvers/sports_resolvers/raw_sports.py](../ArWikiCats/new_resolvers/sports_resolvers/raw_sports.py)
- [ArWikiCats/new_resolvers/sports_resolvers/raw_sports_with_suffixes.py](../ArWikiCats/new_resolvers/sports_resolvers/raw_sports_with_suffixes.py)
- [ArWikiCats/new_resolvers/sports_resolvers/sport_lab_nat.py](../ArWikiCats/new_resolvers/sports_resolvers/sport_lab_nat.py)
- [ArWikiCats/new_resolvers/teams_mappings_ends.py](../ArWikiCats/new_resolvers/teams_mappings_ends.py)

</details>



## Purpose and Scope

The Country Name Resolvers translate Wikipedia categories containing country names from English to Arabic. This resolver handles geographic and political entities such as country-specific history, government structures, military units, geographic features, and sports teams.

**Critical ordering requirement**: Country resolvers must execute **after** Nationality resolvers in the resolver chain to prevent semantic conflicts. For details on nationality-based categories, see [Nationality Resolvers](16.Nationality-Resolvers.md). For country+sport combinations, see [Sports Resolvers](19.Sports-Resolvers.md)

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py L1-L59](../ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py#L1-L59), [ArWikiCats/new_resolvers/__init__.py L64-L72](../ArWikiCats/new_resolvers/__init__.py#L64-L72)

## Resolver Chain Priority and Conflict Prevention

### Why Ordering Matters

The resolver chain priority places Nationalities (priority 6) before Countries (priority 7) to prevent misclassification of nationality adjectives as country names. Without this ordering, categories describing people by nationality would incorrectly resolve as categories about the country itself.

**Conflict Example**:
```
Input: "Italy political leader"

❌ Wrong (if Countries resolver runs first):
   "قادة إيطاليا السياسيون" (political leaders of Italy)

✓ Correct (with Nationalities resolver first):
   "قادة سياسيون إيطاليون" (Italian political leaders)
```

```mermaid
graph TB
    Input["Category: 'Italy political leader'"]

    subgraph "Resolver Chain Execution Order"
        Nats["Priority 6:<br/>Nationalities Resolvers<br/>main_nationalities_resolvers()"]
        Countries["Priority 7:<br/>Countries Names Resolvers<br/>main_countries_names_resolvers()"]
    end

    NatsMatch["Match: 'Italian political leaders'<br/>Pattern: '{nat_en} political leader'<br/>Result: 'قادة سياسيون إيطاليون'"]
    CountriesSkipped["Countries resolver<br/>never executes"]

    Output["Output: 'تصنيف:قادة سياسيون إيطاليون'"]

    Input --> Nats
    Nats -->|Match found| NatsMatch
    NatsMatch --> Output
    Nats -.->|Would execute if no match| Countries
    Countries -.->|Skipped| CountriesSkipped

    style NatsMatch fill:#90ee90
    style CountriesSkipped fill:#ffcccc
```

**Sources**: [ArWikiCats/new_resolvers/__init__.py L64-L72](../ArWikiCats/new_resolvers/__init__.py#L64-L72), [ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py L38-L50](../ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py#L38-L50)

## Main Orchestration Function

The `main_countries_names_resolvers()` function orchestrates five specialized sub-resolvers in priority order:

```mermaid
graph LR
    Input["Normalized category<br/>lowercase, no 'category:' prefix"]

    V2["resolve_by_countries_names_v2()"]
    V1["resolve_by_countries_names()"]
    Medalists["resolve_countries_names_medalists()"]
    States["resolve_us_states()"]
    Geo["resolve_by_geo_names()"]

    Output["Arabic translation<br/>or empty string"]

    Input --> V2
    V2 -->|No match| V1
    V1 -->|No match| Medalists
    Medalists -->|No match| States
    States -->|No match| Geo
    Geo --> Output

    V2 -.->|Match found| Output
    V1 -.->|Match found| Output
    Medalists -.->|Match found| Output
    States -.->|Match found| Output
```

### Internal Resolver Priority

Even within country resolvers, order matters. `resolve_by_countries_names_v2()` must execute before `resolve_by_countries_names()` to avoid misresolving patterns like "Zimbabwe political leader".

| Priority | Function | Purpose |
|----------|----------|---------|
| 1 | `resolve_by_countries_names_v2()` | Nationality-inflected patterns (prevents "Zimbabwe political leader" errors) |
| 2 | `resolve_by_countries_names()` | Standard country name patterns |
| 3 | `resolve_countries_names_medalists()` | Olympic medalists by country |
| 4 | `resolve_us_states()` | US state-specific categories |
| 5 | `resolve_by_geo_names()` | Geographic entity names |

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py L20-L54](../ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py#L20-L54)

## Country Name Data Patterns

### Pattern Structure

The `formatted_data_en_ar_only` dictionary contains 300+ translation patterns using placeholder substitution:

```
Pattern: "{en} history" → "تاريخ {ar}"
Example: "Germany history" → "تاريخ ألمانيا"

Pattern: "government of {en}" → "حكومة {ar}"
Example: "government of France" → "حكومة فرنسا"
```

```mermaid
graph TB
    subgraph "Data Structure: formatted_data_en_ar_only"
        Patterns["English Template Patterns<br/>with {en} placeholder"]
        Arabic["Arabic Template Translations<br/>with {ar} placeholder"]
    end

    subgraph "Lookup Data"
        CountryDict["all_country_with_nat_ar<br/>English → Arabic mappings"]
    end

    subgraph "Formatting Engine"
        Formatter["FormatDataV2<br/>Pattern matching + substitution"]
    end

    Patterns --> Formatter
    Arabic --> Formatter
    CountryDict --> Formatter

    Input["Input: 'germany history'"]
    Match["Match pattern: '{en} history'"]
    Substitute["Substitute: {en}→'germany'<br/>{ar}→'ألمانيا'"]
    Result["Output: 'تاريخ ألمانيا'"]

    Input --> Formatter
    Formatter --> Match
    Match --> Substitute
    Substitute --> Result
```

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/countries_names_data.py L21-L500](../ArWikiCats/new_resolvers/countries_names_resolvers/countries_names_data.py#L21-L500)

### Major Pattern Categories

The data mappings cover these category types:

| Category Type | Pattern Examples | Count |
|---------------|------------------|-------|
| Historical | `history of {en}`, `ancient history of {en}`, `military history of {en}` | ~20 |
| Governmental | `government of {en}`, `ministries of {en}`, `secretaries of {en}` | ~15 |
| Geographic | `mountains of {en}`, `rivers of {en}`, `cities of {en}` | ~80 |
| Military | `military of {en}`, `battles of {en}`, `naval units of {en}` | ~25 |
| Diplomatic | `ambassadors of {en}`, `foreign relations of {en}` | ~10 |
| Political Leaders | `presidents of {en}`, `prime ministers of {en}`, `heads of state of {en}` | ~20 |
| Sports Teams | `{en} national team`, `{en} olympics squad` | ~15 |
| Russian Extensions | `federal subjects of {en}`, `shipyards of {en}` (from `from_russia_data`) | ~150 |

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/countries_names_data.py L12-L507](../ArWikiCats/new_resolvers/countries_names_resolvers/countries_names_data.py#L12-L507)

### Example Patterns

```python
# Historical patterns
"history of {en}": "تاريخ {ar}"
"military history of {en}": "تاريخ {ar} العسكري"
"contemporary history of {en}": "تاريخ {ar} المعاصر"

# Governmental patterns
"government of {en}": "حكومة {ar}"
"parliament of {en}": "برلمان {ar}"
"cabinet of {en}": "مجلس وزراء {ar}"

# Geographic patterns
"mountains of {en}": "جبال {ar}"
"rivers of {en}": "أنهار {ar}"
"islands of {en}": "جزر {ar}"

# Sports patterns
"{en} national team": "منتخبات {ar} الوطنية"
"{en} olympics squad": "تشكيلات {ar} في الألعاب الأولمبية"
```

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/countries_names_data.py L46-L119](../ArWikiCats/new_resolvers/countries_names_resolvers/countries_names_data.py#L46-L119)

## Sub-Resolver Implementations

### countries_names_v2 Resolver

The V2 resolver handles nationality-inflected patterns that require gender-specific translations. This resolver must run first to prevent misclassification.

**Key characteristics**:
- Uses `FormatDataV2` for dictionary-based value lookup
- Accesses nationality data with gender forms (`male`, `female`, `the_male`, `the_female`)
- Pattern: `"{en} political leader"` → `"قادة سياسيون {males}"`

**Example**:
```
Input: "zimbabwe political leader"
Lookup: all_country_with_nat_ar["zimbabwe"]
  → {ar: "زيمبابوي", males: "زيمبابويون", ...}
Pattern: "{en} political leader" → "قادة سياسيون {males}"
Result: "قادة سياسيون زيمبابويون"
```

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/countries_names_v2.py](../ArWikiCats/new_resolvers/countries_names_resolvers/countries_names_v2.py)

### countries_names Resolver

The standard resolver handles patterns where the country name appears in Arabic without gender inflection.

**Key characteristics**:
- Uses simple string substitution `{en}` → `{ar}`
- Handles most geographic and governmental categories
- Pattern: `"history of {en}"` → `"تاريخ {ar}"`

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/countries_names.py](../ArWikiCats/new_resolvers/countries_names_resolvers/countries_names.py)

### medalists_resolvers

Handles Olympic medalist categories by country and sport:

```python
# Pattern examples
"olympic gold medalists for {en}": "فائزون بميداليات ذهبية أولمبية من {ar}"
"olympic silver medalists for {en} in {en_sport}":
  "فائزون بميداليات فضية أولمبية من {ar} في {sport_label}"
```

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/medalists_resolvers.py](../ArWikiCats/new_resolvers/countries_names_resolvers/medalists_resolvers.py)

### us_states Resolver

Specialized resolver for US state-specific categories:

```python
# Pattern examples
"{state} politicians": "سياسيون من {ar_state}"
"{state} musicians": "موسيقيون من {ar_state}"
"governor of {state}": "حاكم {ar_state}"
```

**Data source**: `US_STATES` dictionary mapping English state names to Arabic translations.

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/us_states.py](../ArWikiCats/new_resolvers/countries_names_resolvers/us_states.py)

### geo_names_formats Resolver

Handles geographic entity names using specialized geographic data:

**Data sources**:
- `CITY_TRANSLATIONS_LOWER`: City name mappings
- `COUNTRY_LABEL_OVERRIDES`: Special-case country name translations
- Geographic hierarchies (regions, counties, etc.)

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/geo_names_formats.py](../ArWikiCats/new_resolvers/countries_names_resolvers/geo_names_formats.py)

## Integration with Sports Resolvers

Country name resolvers integrate with sports patterns for categories combining geographic and athletic elements:

```mermaid
graph TB
    subgraph "Country + Sport Pattern Flow"
        Input["Input: 'germany football federation'"]

        CountryMatch["Country pattern detected:<br/>'{en} {en_sport} federation'"]

        Lookups["Parallel lookups:<br/>1. Country: 'germany' → 'ألمانيا'<br/>2. Sport: 'football' → 'كرة القدم'"]

        Template["Template application:<br/>'الاتحاد {the_male} {sport_team}'"]

        Result["Result:<br/>'الاتحاد الألماني لكرة القدم'"]
    end

    Input --> CountryMatch
    CountryMatch --> Lookups
    Lookups --> Template
    Template --> Result
```

### Country+Sport Pattern Examples

These patterns appear in both country and sports resolver modules:

```python
# From sports_resolvers/countries_names_and_sports.py
"{en} {en_sport} federation": "الاتحاد {the_male} {sport_team}"
"{en} national {en_sport} team": "منتخب {ar} {sport_team}"
"{en} {en_sport} league": "دوري {ar} {sport_team}"

# Country placeholder: {en} → {ar}, {the_male}
# Sport placeholder: {en_sport} → {sport_team}, {sport_label}
```

**Resolution priority**:
1. Sports resolvers (priority 5) attempt match first
2. Country resolvers (priority 7) handle pure country patterns
3. Country+Sport resolver (priority 10) handles fallback cases

**Sources**: [ArWikiCats/new_resolvers/sports_resolvers/countries_names_and_sports.py L22-L141](../ArWikiCats/new_resolvers/sports_resolvers/countries_names_and_sports.py#L22-L141), [ArWikiCats/new_resolvers/countries_names_with_sports/__init__.py L1-L37](../ArWikiCats/new_resolvers/countries_names_with_sports/__init__.py#L1-L37)

## Conflict Resolution Examples

### Example 1: Nationality vs Country Disambiguation

```mermaid
graph LR
    subgraph "Input Category"
        I1["'italian politicians'"]
    end

    subgraph "Nationality Resolver Match"
        N1["Pattern: '{nat_en} politicians'<br/>Lookup: italian → 'إيطاليون'<br/>Result: 'سياسيون إيطاليون'"]
    end

    subgraph "Country Resolver Skipped"
        C1["Would match: '{en} politicians'<br/>But never executes"]
    end

    I1 --> N1
    N1 -.->|Blocks| C1

    style N1 fill:#90ee90
    style C1 fill:#ffcccc
```

### Example 2: Internal Country Resolver Ordering

```mermaid
graph LR
    subgraph "Input Category"
        I2["'zimbabwe political leader'"]
    end

    subgraph "V2 Resolver Match"
        V2["Pattern: '{en} political leader'<br/>Uses nationality data<br/>Result: 'قادة سياسيون زيمبابويون'"]
    end

    subgraph "V1 Resolver Skipped"
        V1["Would give: 'قادة زيمبابوي السياسيون'<br/>Incorrect semantics"]
    end

    I2 --> V2
    V2 -.->|Blocks| V1

    style V2 fill:#90ee90
    style V1 fill:#ffcccc
```

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py L38-L50](../ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py#L38-L50)

## Data Flow Architecture

```mermaid
graph TB
    subgraph "Input Processing"
        Input["Raw category string"]
        Normalize["Normalization:<br/>lowercase, strip 'category:'"]
    end

    subgraph "Country Data Sources"
        CountryDict["all_country_with_nat_ar<br/>English/Arabic + gender forms"]
        GeoData["CITY_TRANSLATIONS_LOWER<br/>COUNTRY_LABEL_OVERRIDES"]
        StateData["US_STATES<br/>State name mappings"]
        SportCountry["countries_from_nat<br/>Country names from nationalities"]
    end

    subgraph "Pattern Matching"
        V2Patterns["formatted_data_en_ar_only<br/>+ nationality gender patterns"]
        V1Patterns["formatted_data_en_ar_only<br/>standard patterns"]
        MedalPatterns["Olympic medalist patterns"]
        StatePatterns["US state patterns"]
        GeoPatterns["Geographic entity patterns"]
    end

    subgraph "Resolvers (Priority Order)"
        V2Res["resolve_by_countries_names_v2()"]
        V1Res["resolve_by_countries_names()"]
        MedalRes["resolve_countries_names_medalists()"]
        StateRes["resolve_us_states()"]
        GeoRes["resolve_by_geo_names()"]
    end

    Output["Arabic category translation"]

    Input --> Normalize

    CountryDict --> V2Res
    CountryDict --> V1Res
    GeoData --> GeoRes
    StateData --> StateRes
    SportCountry --> MedalRes

    V2Patterns --> V2Res
    V1Patterns --> V1Res
    MedalPatterns --> MedalRes
    StatePatterns --> StateRes
    GeoPatterns --> GeoRes

    Normalize --> V2Res
    V2Res -->|No match| V1Res
    V1Res -->|No match| MedalRes
    MedalRes -->|No match| StateRes
    StateRes -->|No match| GeoRes

    V2Res -.->|Match| Output
    V1Res -.->|Match| Output
    MedalRes -.->|Match| Output
    StateRes -.->|Match| Output
    GeoRes -.->|Match| Output
    GeoRes -->|No match| Output
```

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py L1-L59](../ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py#L1-L59), [ArWikiCats/new_resolvers/countries_names_resolvers/countries_names_data.py L1-L508](../ArWikiCats/new_resolvers/countries_names_resolvers/countries_names_data.py#L1-L508)

## Key Implementation Details

### Caching Strategy

All resolver functions use `@functools.lru_cache(maxsize=10000)` for performance:

```python
@functools.lru_cache(maxsize=10000)
def main_countries_names_resolvers(normalized_category: str) -> str:
    # Resolver logic
```

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py L21-L22](../ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py#L21-L22)

### Normalization Process

Input categories undergo consistent normalization:

1. `.strip()` - Remove leading/trailing whitespace
2. `.lower()` - Convert to lowercase
3. `.replace("category:", "")` - Remove category prefix

```python
normalized_category = normalized_category.strip().lower().replace("category:", "")
```

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py L34](../ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py L34)

### Return Value Behavior

All sub-resolvers follow the same contract:
- Return non-empty string on successful match
- Return empty string `""` if no pattern matches
- First non-empty result short-circuits the chain

**Sources**: [ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py L38-L50](../ArWikiCats/new_resolvers/countries_names_resolvers/__init__.py#L38-L50)29:T5bdb,# Job Resolvers

