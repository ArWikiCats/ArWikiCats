# -*- coding: utf-8 -*-
"""Pytest to validate all title lists using fixlab()."""

import pytest
from pathlib import Path
from src.fix.fixtitle import fixlab
from src import printe

Dir = Path(__file__).parent

# --- Lists to test ---
lista = {
    1: [
        "2020 في جنوب إفريقيا",
        "عقد 2010 في جنوب إفريقيا",
        "القرن 21 في جنوب إفريقيا",
        "2020 ق م في جنوب إفريقيا",
        "عقد 2010 ق م في جنوب إفريقيا",
        "القرن 21 في الأردن",
        "عقد 1990 في السعودية",
        "1995 في الإمارات",
        "القرن 20 في مصر",
        "القرن 20 ق م في مصر",
        "عقد 1980 ق م في العراق",
        "الألفية 1 في اليمن",
        "2020 في مولدافيا",
    ],
    2: [],
    3: [
        "تصنيف:قضاة حسب الجنسية عقد 2010",
        "تصنيف:التلفاز في السويد حسب السنة",
        "تصنيف:فنانون ذكور حسب الجنسية 2020",
        "تصنيف:قضاة حسب الجنسية القرن 20",
        "تصنيف:فنانون ذكور حسب الجنسية القرن 20",
        "تصنيف:ملكيون حسب البلد القرن 20",
        "تصنيف:فلاسفة فرنسيون في القرن 20",
    ],
    4: [
        "تصنيف:أشخاص حسب الجنسية والمجموعة العرقية القرن 20",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 1 ق م",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 1",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 2 ق م",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 20",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 21",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 2",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 3 ق م",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 3",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 4 ق م",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 4",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 5 ق م",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 5",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 6",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 7",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 8",
        "تصنيف:أشخاص حسب الجنسية والمهنة القرن 9",
        "تصنيف:أشخاص حسب الدين والجنسية القرن 19",
        "تصنيف:أشخاص حسب الدين والجنسية القرن 20",
        "تصنيف:أشخاص حسب المجموعة العرقية القرن 12",
        "تصنيف:أشخاص حسب المجموعة العرقية القرن 14",
        "تصنيف:أشخاص حسب المجموعة العرقية القرن 15",
        "تصنيف:أشخاص حسب المجموعة العرقية القرن 16",
        "تصنيف:أشخاص حسب المجموعة العرقية القرن 20",
        "تصنيف:أشخاص حسب المجموعة العرقية القرن 21",
        "تصنيف:أشخاص حسب المهنة والجنسية القرن 10",
        "تصنيف:أشخاص حسب المهنة والجنسية القرن 11",
        "تصنيف:أشخاص حسب المهنة والجنسية القرن 12",
        "تصنيف:أشخاص حسب المهنة والجنسية القرن 18",
        "تصنيف:أشخاص حسب المهنة والجنسية القرن 7",
        "تصنيف:أشخاص حسب المهنة والجنسية القرن 8",
        "تصنيف:أشخاص حسب المهنة والجنسية القرن 9",
        "تصنيف:رجال حسب المهنة والجنسية القرن 18",
        "تصنيف:سياسيون حسب تقسيمات البلدان من المستوى الأول القرن 17",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1930",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1931",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1932",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1933",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1935",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1936",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1937",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1938",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1939",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1940",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1941",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1942",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1943",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1944",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1945",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1946",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1947",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1948",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1949",
        "تصنيف:قوائم أفلام حسب البلد أو اللغة 1950",
    ],
}


@pytest.mark.parametrize("group_id, titles", lista.items())
def test_fixlab_all_lists(group_id, titles):
    """Run fixlab() on all lists and ensure output is not empty."""
    data = {}
    same = []

    for title in titles:
        clean_title = title.replace("تصنيف:", "").replace("_", " ")
        new = fixlab(clean_title).replace("جرائم قتل", "جرائم قتل في")

        if new != clean_title:
            data[clean_title] = new
        else:
            same.append(clean_title)

    # Write summary file
    text = "\n".join(f"# [[:تصنيف:{k}]]>[[:تصنيف:{v}]]" for k, v in data.items())
    if same:
        text += "\n\n== same ==\n\n"
        text += "\n".join(f"# [[:تصنيف:{k}]]" for k in same)

    out_file = Dir / f"fixtitle_list_{group_id}.txt"
    out_file.write_text(text, encoding="utf-8")

    printe.output(f"<<green>>List {group_id} processed: {len(data)} changed, {len(same)} same.")

    # --- Basic assertion ---
    assert isinstance(data, dict)
    assert all(isinstance(k, str) and isinstance(v, str) for k, v in data.items())
